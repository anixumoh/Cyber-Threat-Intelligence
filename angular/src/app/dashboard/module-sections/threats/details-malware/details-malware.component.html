<ng-container *ngIf="resource && resource.header && allLoaded; else loading">
  <!-- MAIN HEADER -->
  <div *ngIf="moduleNameHeader" class="main-header row align-items-end mt-4 pb-3 clearfix">
    <div class="main-header-left col float-left">
      <h6 class="text-muted text-uppercase text-90 font-weight-bold mb-3 mt-1">Threats</h6>
      <h5 class="text-dark mb-0">{{ moduleNameHeader }}</h5>
    </div>
    <div class="main-header-right col-auto float-right">
      <div class="btn-group btn-group-sm float-right">
        <button
          class="btn btn-light btn-sm border text-primary"
          type="button"
          (click)="navigateDetails('previous')"
          [disabled]="!showNavigation || !showPrev"
        >
          <i class="icon-angle-left px-1"></i>
        </button>
        <button type="button" class="btn btn-light btn-sm border text-primary" (click)="navigateToThreats()">
          Back to list
        </button>
        <button
          class="btn btn-light btn-sm border text-primary"
          type="button"
          (click)="navigateDetails('next')"
          [disabled]="!showNavigation || !showNext"
        >
          <i class="icon-angle-right px-1"></i>
        </button>
      </div>
    </div>
  </div>
  <!-- MAIN HEADER DETAILS -->
  <div class="main-header-detail bg-light border-top border-bottom p-2 mb-2 clearfix">
    <div class="main-header-left">
      <!-- BTN MARK INCIDENT -->
      <button
        class="btn btn-light btn-sm mr-1 float-left"
        *ngIf="!isTrial && !grants?.isCustomer()"
        type="button"
        name="button"
        (click)="onClickIssue()"
        [ngClass]="isIssued() ? 'buttonActive' : 'btn-light'"
      >
        Mark as incident
      </button>
      <app-modal-add-incident
        [isModalOpen]="isAddIncidentModalOpen"
        [resource]="resource"
        (closeModal)="isAddIncidentModalOpen = false"
      >
      </app-modal-add-incident>
      <modal-view-incident [isModalOpen]="isViewIncidentModalOpen" (onCloseModal)="isViewIncidentModalOpen = false">
      </modal-view-incident>
      <!-- BTN FAV -->
      <button
        class="btn btn-sm mr-1 float-left"
        type="button"
        (click)="onChangeMarkAsFavorite()"
        [ngClass]="isFav() ? 'buttonActive' : 'btn-light'"
      >
        Mark as favorite
      </button>
      <!-- MARK READ BUTTON -->
      <button
        class="btn btn-sm mr-1 float-left"
        [ngClass]="markedAsUnread ? 'btn-light' : 'buttonActive'"
        type="button"
        (click)="onChangeMarkAsRead(true)"
      >
        Mark as read
      </button>
      <!-- MARK UNREAD BUTTON -->
      <button
        class="btn btn-sm mr-1 float-left"
        type="button"
        (click)="onChangeMarkAsRead(false)"
        [ngClass]="!markedAsUnread ? 'btn-light' : 'buttonActive'"
      >
        Mark as unread
      </button>
      <!-- BTN LABELS -->
      <div class="float-left mr-1">
        <app-labels-temp [type]="'action'" [isDetails]="true"></app-labels-temp>
      </div>
      <!-- DELETE BUTTON -->
      <button
        class="btn btn-light btn-delete btn-sm text-danger mr-1 float-left"
        [disabled]="grants.isCustomer()"
        (click)="deleteThreat()"
        nohref
        *ngIf="!isTrial && !grants?.isCustomer()"
      >
        Delete threat
      </button>
    </div>
    <div class="main-header-right">
      <button #commentModalButton class="btn btn-light btn-sm float-right" (click)="detailComments.toggleMenu()">
        Comments Â· {{ commentsNum || 0 }}
      </button>
      <resource-comments
        #detailComments
        [commentModalButtons]="[commentModalButton]"
        [resourceId]="resource.id"
        [moduleName]="activeModule.moduleName"
        (commentsNumber)="updateComments($event)"
      >
      </resource-comments>
    </div>
  </div>
  <!-- DETAIL HEADER -->
  <div class="border rounded p-2 mb-2">
    <details-header
      [headerData]="headerData"
      [resource]="resource.header"
      [labelProperty]="'name'"
      [moduleName]="activeModule.moduleName"
    >
    </details-header>
  </div>

  <div class="border rounded p-2 bg-light clearfix mb-2">
    <!-- Affected Fields -->
    <button
      *ngIf="!grants?.isCustomer()"
      class="btn btn-light btn-sm border buttonActive float-left mr-1"
      type="button"
      name="button"
      (click)="onToggleModal()"
    >
      View Affected fields
    </button>
  </div>
  <!-- MALWARE TABS -->
  <app-generic-tab [content]="this.tabData" (onSelectEmitter)="selectImport($event)"> </app-generic-tab>
  <!-- SUMMARY -->
  <div *ngIf="isShow === 'Summary'">
    <app-summary-tab></app-summary-tab>
  </div>
  <!-- STATIC -->
  <div *ngIf="isShow === 'Static'">
    <app-static-tab></app-static-tab>
  </div>
  <!-- DYNAMIC -->
  <div *ngIf="isShow === 'Dynamic'">
    <app-dynamic-tab></app-dynamic-tab>
  </div>
  <!-- NETWORK -->
  <div *ngIf="isShow === 'Network'">
    <app-network-tab></app-network-tab>
  </div>

  <!-- PROCESS TREE -->
  <section
    class="module-preview"
    [class.open]="isPreviewOpened || malwareDynamicsService.isSelected"
    [class.bigPreview]="malwareDynamicsService.isSelected"
    (swiperight)="onSwiperightPreview()"
    *ngIf="resource && allLoaded"
  >
    <div>
      <header class="title">
        <h3 *ngIf="isPreviewOpened">{{ resource.title }}</h3>
        <h3>{{ malwareDynamicsService.selectedName() }}</h3>

        <div *ngIf="isPreviewOpened" class="comments is-white no-pointer">{{ resource.comments }}</div>
      </header>
      <main>
        <article *ngIf="malwareDynamicsService.selectedProcess" class="content-file">
          <p>
            <span class="glyphicon glyphicon-time"></span>
            <span>{{ malwareDynamicsService.selectedProcessMetadata.first_seen }}</span>
          </p>
          <p>
            <span class="glyphicon glyphicon-file"></span>
            <span>{{ malwareDynamicsService.selectedProcessMetadata.process_name }}</span>
          </p>
          <ngb-tabset class="tab-widget">
            <ngb-tab *ngFor="let detail of malwareDynamicsService.getDetails()">
              <ng-template ngbTabTitle>
                {{ detail.title }}
              </ng-template>
              <ng-template ngbTabContent>
                <div class="detail_content" *ngIf="detail.leaf === true">
                  <span class="detail_line" *ngFor="let line of detail.content">{{ line }}</span>
                </div>
                <div class="nestedtabs_container" *ngIf="detail.leaf === false">
                  <ng-container *ngTemplateOutlet="innerTabset; context: detail"></ng-container>
                </div>
              </ng-template>
            </ngb-tab>
          </ngb-tabset>
        </article>
        <article *ngIf="malwareDynamicsService.selectedFile" class="content-file scroll">
          {{ malwareDynamicsService.selectedFile.content || "There isn't any content" }}
        </article>
        <div *ngIf="!malwareDynamicsService.selectedFile">
          <article *ngFor="let item of comments" class="single-comment mvm">
            <section class="comment-mail">
              <span>{{ item.email }}</span>
              <i class="material-icons delete">delete</i>
            </section>
            <section class="comment-date">
              <span>{{ item.date }}</span>
            </section>
            <section class="comment-text pvm">
              <p>
                {{ item.comment }}
              </p>
            </section>
          </article>
        </div>
      </main>
    </div>
  </section>
  <!-- SUB_TABS PROCESS TREE -->
  <ng-template #innerTabset let-content="content">
    <ngb-tabset class="tab-widget">
      <ngb-tab *ngFor="let subdetail of content">
        <ng-template ngbTabTitle>
          {{ subdetail.title }}
        </ng-template>
        <ng-template ngbTabContent>
          <div class="detail_content">
            <span class="detail_line" *ngFor="let line of subdetail.content">{{ line }}</span>
          </div>
        </ng-template>
      </ngb-tab>
    </ngb-tabset>
  </ng-template>
</ng-container>

<!-- LOADING PROCESS -->
<ng-template #loading>
  <div class="no-results-box">
    <i class="icon-spinner rotate"></i>
    <h3 class="no-results">Loading</h3>
  </div>
</ng-template>

<modal-window (cancel)="onToggleModal()" [modalTitle]="'Affected fields'" *ngIf="openDefaultModal">
  <ng-template [ngIf]="affectedFields.length">
    <div *ngFor="let item of affectedFields">
      <span
        ><strong>"{{ item.domain }}"</strong> domain was found in:</span
      >
      <ul class="my-ul">
        <li *ngFor="let affected of item.affectedFields">
          {{ affected }}
        </li>
      </ul>
    </div>
  </ng-template>
  <span *ngIf="!affectedFields.length">It has not affected fields</span>
</modal-window>
