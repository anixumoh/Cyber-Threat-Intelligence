<script lang="ts">
  import GenericButton from '$lib/components/Buttons/GenericButton.svelte';
  import CommonModal from '$lib/components/CommonModal/CommonModal.svelte';
  import EmptyData from '$lib/components/EmptyData/EmptyData.svelte';
  import ResponsivePageNavigation from '$lib/components/ResponsivePageNavigation.svelte';
  import { DataTable } from 'carbon-components-svelte';

  export let elements = [];
  let pageSize = 10;
  let page = 1;

  let valueToShow = undefined;

  let titleModal = '';
  let openModal = false;

  $: numPages = Math.ceil(elements.length / pageSize);
</script>

<div class="w-full">
  {#if elements.length}
    <DataTable
      {pageSize}
      {page}
      headers={[
        { key: 'host', value: 'DOMAIN' },
        { key: 'ip', value: 'IP' },
        { key: 'request', value: 'REQUEST' },
        { key: 'response', value: 'RESPONSE' }
      ]}
      rows={elements}
      class="[&_td]:text-center"
    >
      <svelte:fragment slot="cell" let:cell let:row>
        {#if cell.key === 'request'}
          <GenericButton
            on:click={() => {
              valueToShow = row?.request;
              titleModal = 'Request';
              openModal = true;
            }}>View</GenericButton
          >
        {:else if cell.key === 'response'}
          <GenericButton
            on:click={() => {
              valueToShow = row?.response;
              titleModal = 'Response';
              openModal = true;
            }}>View</GenericButton
          >
        {:else}
          <span class="flex text-center justify-center">
            {cell.value}
          </span>
        {/if}
      </svelte:fragment>
    </DataTable>
    <div class="flex items-center">
      <ResponsivePageNavigation bind:page total={numPages} />
    </div>
  {:else}
    <EmptyData />
  {/if}
</div>

<CommonModal bind:open={openModal} passiveModal modalHeading={titleModal} on:closeModal={() => (openModal = false)}>
  <pre class="text-center">{valueToShow}</pre>
</CommonModal>
