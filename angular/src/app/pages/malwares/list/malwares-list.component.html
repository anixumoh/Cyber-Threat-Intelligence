<app-upload [history]="getHistory()" (upload)="onUpload($event)" (removeHistory)="onRemoveHistory($event)">
</app-upload>
<div class="card shadow-sm">
  <!-- FILTERS -->
  <div class="main-header-table rounded-top bg-light p-2 clearfix mx-0 fixed-scroll">
    <div class="float-left pr-3 mr-3">
      <div class="button-action" ngbDropdown>
        <button
          ngbDropdownToggle
          [disabled]="!hasSomeChecked()"
          class="btn btn-light btn-sm border px-2 float-left btn-actions"
          [ngClass]="{ pulse: hasSomeChecked() }"
          type="button"
          id="actionsButtonDropdown"
          name="button"
        >
          <i class="icon-ellipsis-v px-1"></i>
        </button>
        <div ngbDropdownMenu class="actions-dropdown-menu">
          <ul class="list-group actions-menu shadow border rounded" aria-labelledby="actionsButtonDropdown">
            <li
              class="list-group-item list-group-item-action cursor-pointer list-group-item-delete border-0 px-3 py-2"
              (click)="openDeleteModal()"
            >
              <i class="icon-delete text-danger mr-2"></i>
              <span class="text-danger">Delete</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="float-right">
      <app-select
        [items]="limits"
        [model]="limit"
        [icon]="'icon-format_list_bulleted'"
        [placement]="'bottom-right'"
        id="limitDropdown"
        (onChange)="onChangeLimit($event)"
      >
      </app-select>
    </div>
    <div class="input-group input-group-sm float-right" style="width: 275px; margin-right: 10px">
      <input
        class="form-control"
        type="text"
        placeholder="Search..."
        style="height: 31px"
        [(ngModel)]="searchText"
        (keyup.enter)="search()"
      />
      <div class="input-group-append" (click)="search()">
        <span class="input-group-text"> <i class="icon-search"></i></span>
      </div>
    </div>
  </div>
  <!--TABLE-->
  <div>
    <app-table [items]="items" [loading]="loading" class="table-fixed">
      <thead>
        <tr>
          <th class="text-center td-30">
            <input type="checkbox" [(ngModel)]="bulk" (click)="setCheckedState($event)" />
          </th>
          <th class="text-center">Name</th>
          <th class="text-center table-responsive-width">Platform</th>
          <th class="text-center table-responsive-width">File Size</th>
          <th class="text-center table-responsive-width">Update Date</th>
          <th class="text-center table-responsive-width">Analysis Status</th>
          <th class="td-90 text-center">Severity</th>
          <th class="td-50"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items; let index = index" [ngClass]="item.id ? '' : 'pending'">
          <td class="align-middle text-center">
            <input type="checkbox" [disabled]="!item.id" [(ngModel)]="item.fxSelected" (click)="setChecked()" />
          </td>
          <td class="align-middle truncate-lineal" style="width: 22%">
            <div
              class="text-primary cursor-pointer"
              *ngIf="item.id"
              routerLink="/dashboard/organizations/{{ activeOrganization.id }}/modules/{{
                activeModule.id
              }}/threat_context/malwares/{{ item.sha256 }}/summary"
            >
              <app-large-text [value]="item.file_name"></app-large-text>
            </div>
            <div *ngIf="!item.id">
              <app-large-text [value]="item.file_name"></app-large-text>
            </div>
          </td>
          <td class="align-middle text-center">{{ item.platform }}</td>
          <td class="align-middle text-center">{{ item.file_size || '-' }}</td>
          <td class="align-middle truncate-lineal text-center">
            {{ timeFromNow(item.upload_date) }}
          </td>
          <td class="align-middle text-center truncate-lineal">
            <b>{{ item.status }}</b>
          </td>
          <td class="align-middle text-center">
            <button class="btn btn-circle">
              <i class="icon-lens text-danger"></i>
            </button>
          </td>
          <td class="align-middle">
            <button *ngIf="!item.id" class="btn btn-circle" ngbTooltip="delete" (click)="destroy(item)">
              <i class="icon-delete text-danger"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </app-table>
  </div>
</div>
<!-- PAGINATION -->
<div class="float-left">
  <app-pagination-x [page]="page" [count]="count" [pageSize]="limit" (pageChange)="onPageChange($event)">
  </app-pagination-x>
</div>
<!-- MODAL -->
<modal-window
  modalTitle="Remove malware(s)"
  modalBody="Are you sure to remove the selected malware(s)?"
  *ngIf="isDeleteConfirmationOpened"
  acceptBtn="Yes"
  cancelBtn="No"
  (accept)="destroySelected(); isDeleteConfirmationOpened = false"
  (cancel)="isDeleteConfirmationOpened = false"
>
</modal-window>
