<!--TABLE-->
<div class="table-container">
  <app-table [items]="data" [loading]="loading">
    <thead>
    <tr>
      <th class="text-center">PID</th>
      <th class="">Origin</th>
      <th class="">Name</th>
      <th class="">sha256</th>
      <th class="text-center">Process</th>
      <th class="text-center">Malware Type</th>
      <th class="">Match</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let item of data; let index = index;">
      <td class="align-middle text-center text-primary td-link cursor-pointer" (click)="openDetails(item.origin_key,item.id)">{{ item.pid }}</td>
      <td class="align-middle">{{ item.origin }}</td>
      <td class="align-middle">{{ item.name }}</td>
      <td class="align-middle"
          style="max-width: 200px; overflow: hidden; text-overflow:ellipsis;">{{ item.sha256 }}</td>
      <td class="align-middle text-center">{{ item.process_name }}</td>
      <td class="align-middle text-center">{{ item.malware_type }}</td>
      <ng-container *ngIf="item.match.length > 0">
        <td class="align-middle" style="max-width: 100px; overflow: hidden; text-overflow:ellipsis;">
          <ng-container *ngFor="let y of item.match">
            {{ y }}<br>
          </ng-container>
        </td>
      </ng-container>
      <ng-container *ngIf="item.match.length <= 0">
        <td class="align-middle"> -</td>
      </ng-container>

    </tr>
    </tbody>
  </app-table>
</div>

<div class="float-left">
  <app-pagination-x [page]="page"
                    [count]="count"
                    [pageSize]="limit"
                    (pageChange)="onPageChange($event)">
  </app-pagination-x>
</div>

<app-drawer [open]="selectedItem" (close)="selectedItem = null" width="760px" title="Details">
  <div class="" *ngIf="selectedItem">
    <div class="card-tab mb-3">
      <ul class="nav nav-pills border-bottom">
        <li [ngClass]="{'is-active': tab.name === activeTab.name}"
            *ngFor="let tab of tabs"
            (click)="activeTab = tab"
            role="presentation">
          {{ tab.name }}
        </li>
      </ul>
    </div>

    <div class="card" *ngIf="activeTab.name === 'Urls'">
      <div class="card-header">
        URL
      </div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item" style="padding: 10px 15px" *ngFor="let url of selectedItem.urls || []">
          <i class="icon-globe text-primary mr-2"></i> {{url}}
        </li>
      </ul>
    </div>

    <div *ngIf="activeTab.name === 'Yara'">
      <div class="card mb-2" *ngFor="let item of selectedItem.yara || []">
        <div class="card-header">
          <h6 class="text-dark mb-0">{{ item.rule || item.name || '-' }}</h6>
        </div>
        <div class="card-body p-3">
          <div class="row">
            <div class="col col-3">
              <p class="card-title">{{ item.meta?.description }}</p>
            </div>
            <div class="col">
              <div class="pre">
                <code class="card-text" [innerHTML]="item.code"></code>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-container" *ngIf="activeTab.name === 'Info'">
      <app-table [items]="[selectedItem]" [loading]="loading">
        <thead>
        <tr>
          <th *ngFor="let col of selectedItem.columns">
            {{ col.title }}
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let row of [selectedItem]">
          <td class="align-middle" *ngFor="let col of selectedItem.columns">
            {{ row[col.name] || '' }}
          </td>
        </tr>
        </tbody>
      </app-table>
    </div>
  </div>
</app-drawer>
