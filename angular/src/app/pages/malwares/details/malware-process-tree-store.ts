import { take } from 'rxjs/operators';
import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { MalwaresService } from '../../../core/models/malwares.service';

@Injectable()
export class MalwareProcessTreeStore {
  private _state = new BehaviorSubject(null);

  constructor(private malwaresService: MalwaresService) {}

  getData(malwareId) {
    this.malwaresService
      .getProcessTree(malwareId)
      .pipe(take(1))
      .subscribe(response => this.setState(response.data));
  }

  get state$() {
    return this._state;
  }

  get state() {
    return this._state.getValue();
  }

  setState(newState) {
    this._state.next(newState);
  }
}
