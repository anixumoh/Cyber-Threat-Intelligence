import { Component, Input, OnInit } from '@angular/core';

@Component({
  selector: 'app-malware-details-static-pe32',
  templateUrl: './pe32.component.html',
})
export class MalwareStaticPE32Component implements OnInit {
  peSectionsTableColumns = [
    {
      name: 'Name',
      dataKey: 'name',
    },
    {
      name: 'Virtual Address',
      dataKey: 'virtual_address',
    },
    {
      name: 'Virtual Size',
      dataKey: 'virtual_size',
    },
    {
      name: 'Size of Raw Data',
      dataKey: 'size_of_data',
    },
    {
      name: 'Entropy',
      dataKey: 'entropy',
    },
  ];

  peResourcesTableColumns = [
    {
      name: 'Name',
      dataKey: 'name',
    },
    {
      name: 'Offset',
      dataKey: 'offset',
    },
    {
      name: 'Size',
      dataKey: 'size',
    },
    {
      name: 'Language',
      dataKey: 'language',
    },
    {
      name: 'Sub-language',
      dataKey: 'sublanguage',
    },
    {
      name: 'File Type',
      dataKey: 'filetype',
    },
  ];

  peExportsTableColumns = [
    {
      name: 'Ordinal',
      dataKey: 'ordinal',
    },
    {
      name: 'Address',
      dataKey: 'address',
    },
    {
      name: 'Name',
      dataKey: 'name',
    },
  ];

  @Input() staticInfo;
  public isEmpty = false;

  public versionInfoList = [];

  constructor() {}

  ngOnInit() {
    if (!this.staticInfo || !this.staticInfo.hasOwnProperty('pe_sections')) {
      this.isEmpty = true;
      return;
    }
    if (
      this.staticInfo.pe_sections.length <= 0 &&
      this.staticInfo.pe_resources.length <= 0 &&
      this.staticInfo.pe_imports.length <= 0 &&
      this.staticInfo.pe_exports.length <= 0
    ) {
      this.isEmpty = true;
    }
    this.versionInfoList = this.versionInfo();
  }

  private versionInfo() {
    const out = [
      { title: 'PDB Path', value: this.staticInfo['pdb_path'] },
      { title: 'PE Imphash', value: this.staticInfo['pe_imphash'] },
      { title: 'Compilation Time', value: this.staticInfo['pe_timestamp'] },
    ];
    for (let pe_version of this.staticInfo['pe_versioninfo']) {
      if (pe_version['value']) {
        out.push({ title: pe_version['name'], value: pe_version['value'] });
      }
    }
    return out;
  }
}
