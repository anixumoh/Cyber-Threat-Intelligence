import { tap, take } from 'rxjs/operators';
import { Injectable } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { MalwaresService } from '../../../core/models/malwares.service';

@Injectable()
export class MalwaresStore {
  private _state = new BehaviorSubject(null);

  constructor(private malwaresService: MalwaresService) {}

  getData(malwareId) {
    return this.malwaresService.details(malwareId).pipe(
      take(1),
      tap((response: any) => {
        const { data } = response;
        data.malwareId = malwareId;
        this.setState(data);
      })
    );
  }

  get state$() {
    return this._state;
  }

  get state() {
    return this._state.getValue();
  }

  setState(newState) {
    this._state.next(newState);
  }
}
